<!DOCTYPE html>
<html>
    <head>
        <title>TalentOnCloud</title>

        <!-- jQuery 3.5.1 -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        <!-- BootStrap 3.3.7 -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <!-- Custom -->
        <style type="text/css">
            ::-webkit-scrollbar {
                width: 7px;
            }

            /* Track */
            ::-webkit-scrollbar-track {
                background: rgba(103, 3, 255, 1);
                /*box-shadow: inset 0 0 5px grey; */
                /*border-radius: 10px;*/
            }
             
            /* Handle */
            ::-webkit-scrollbar-thumb {
                background-color: rgba(0, 0, 0, 0.8);
                border-radius: 10px;
            }

            /* Handle on hover */
            ::-webkit-scrollbar-thumb:hover {
                /*background: #b30000; */
            }

            body
            {
                background-image: linear-gradient( 109.2deg,  rgba(254,3,104,1) 9.3%, rgba(103,3,255,1) 89.5% );
                background-size: cover;
                background-attachment: fixed;
            }

            .card
            {
                position: relative;
                margin: 0 5px 0 5px;
                background: rgba(255, 255, 255, 0.9);
                /*padding: 40px;*/
                box-sizing: border-box;
                box-shadow: 0 15px 25px rgba(0,0,0,0.5);
                border-radius: 5px;
            }
            .card .title
            {
                text-align: center;
                font-size: 20px;
                padding-bottom: 10px;
            }

            .video
            {
            	width: 100%;
            }
            .video video
            {
            	width: 100%;
            	height: 500px;
            	background-color: black;
            	padding: 0;
            }

            .video .operations
            {
                padding: 0px 10px;
                margin-bottom: 30px;
            }
            .video .operations .operation
            {
                float: right;
                border: none;
                outline: none;
                background-color: rgba(77, 5, 232, 0.8);
                color: white;
                border-radius: 4px;
                padding: 2px 10px;
                margin-left: 10px;
            }
            .video .operations .operation:hover
            {
                background-color: rgba(77, 5, 232, 1);
            }

            .comments .chat
            {
            	padding: 10px 10px p0x 10px;
            }
            .chat .row
            {
                padding: 0 10px;
            }

            .comments .chat .recieved
            {
            	margin-bottom: 10px;
            	background-color: rgba(77, 5, 232, 1);
            	color: white;
            	/*width: 80%;*/
            	display: inline-block;
            	border-radius: 5px;
            	/*border-color: transparent black transparent transparent;*/
            	padding: 0 10px 0 0;
            	max-width: 80%;
            }
            .comments .chat .recieved .name
            {
            	font-weight: bold;
            	padding: 1px 5px;
            }
            .comments .chat .recieved .name:before
            {
            	content: "@";
            }
            .comments .chat .recieved .message
            {
            	padding: 1px 5px 0 20px;
            }

            .comments .chat .sent
            {
            	margin-bottom: 10px;
            	background-color: rgba(46, 204, 113, 1);
            	color: white;
            	display: inline-block;
            	border-radius: 5px;
            	padding: 0 10px 0 0;
            	float: right;
            	max-width: 80%;
            }
            .comments .chat .sent .name
            {
            	font-weight: bold;
            	padding: 1px 5px;
            }
            .comments .chat .sent .name:before
            {
            	content: "@";
            }
            .comments .chat .sent .message
            {
            	padding: 1px 5px 0 20px;
            }
            .comments .send_message
            {
            	padding: 5px;
            }
            .comments .send_message input
            {
            	outline: none;
            	border-radius: 20px;
            	padding: 5px 15px;
            	width: 90%;
            	border: 1px solid;
            }
            .comments .send_message svg
            {
            	cursor: pointer;
            	width: 30px;
            	height: 30px;
            	padding-top: 10px;
            }
        </style>

    </head>

    <body>
        <nav class="navbar navbar-inverse">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>                        
              </button>
                    <a class="navbar-brand" href="index.html">TalentOnCloud</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                        <li class="navclick"><a href="../index.html">Home</a></li>
                        <li class="active navclick"><a href="index.html">Dashboard</a></li>
                        <li class="navclick"><a href="#">Contact us</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Full Name<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li class="navclick"><a href="#" data-toggle="modal" data-target="#myModal<?php echo $userdata['userid']; ?>">Profile</a></li>
                                <li class="navclick"><a href="../index.html">Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
        	<div class="row">

        		<div class="col-sm-8">
        			<div class="video card">
        				<video id="video" autoplay></video>
            			<div class="container-fluid">
                           <div class="row">
                               <div class="operations">
                                    <button state="off" class="screenShare operation">Start ScreenShare</button>
                                    <button state="off" class="camera operation">Start Video</button>
                                </div>         
                            </div>         
                        </div>
        			</div>
        		</div>
        		<div class="col-sm-4">
        			<div class="comments card">
        				<div class="title">Comments</div>
        				<div class="chat">

                            <div class="container-fluid">
                                <div class="row">
                                    <div class="recieved">
                                        <div class="name">User 1</div>
                                        <div class="message">Hi</div>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="sent">
                                        <div class="name">User 2</div>
                                        <div class="message">Hello, what is the purpose of this event?</div>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="recieved">
                                        <div class="name">User 1</div>
                                        <div class="message">You will get some knowledge about what are the important skills needed.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="sent">
                                        <div class="name">User 2</div>
                                        <div class="message">ok sir, Thank you</div>
                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="recieved">
                                        <div class="name">User 1</div>
                                        <div class="message">So, lets start the session.</div>
                                    </div>
                                </div>
                            </div>

        				</div>

        				<div class="send_message">
        					<input type="text" id="input_message" autocomplete="false">
        					<svg onclick="sendMessage()" viewBox="180 -100 535.5 535.5" >
								<g><polygon points="0,497.25 535.5,267.75 0,38.25 0,216.75 382.5,267.75 0,318.75"/></g>
							</svg>
        				</div>

        			</div>
        		</div>
        	</div>
        </div>


    </body>
</html>

<script>

    function sendMessage()
    {
        var msg = $('#input_message').val();
        var html = '<div class="container-fluid"> <div class="row"> <div class="sent"> <div class="name">User 2</div><div class="message">'+msg+'</div></div></div></div>';
        $('.chat').append(html);

        $('#input_message').val("");
    }

    $("#input_message").keyup(function(e){
        if (event.keyCode === 13) sendMessage();
    });


    // Video On hover -> Display controls
    $("video").prop("controls", false);
    $("video").hover(function() {
        $(this).prop("controls", true);
    }, function() {
        $(this).prop("controls", false);
    });
</script>

<script>

    video_switch = null;
    screenShare_switch = null;
	
    // Screeen Sharing
    async function screenShare(displayMediaOptions) 
    {
        var video = document.getElementById('video');
        let captureStream = null;

        try {
            captureStream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions).then(function(stream) {
            //video.src = window.URL.createObjectURL(stream);
            screenShare_switch = stream;
            video.srcObject = stream;
            video.play();
        });
        } catch(err) {
            console.error("Error: " + err);
        }
        return captureStream;
    }
    // screenShare();


	// Camera
	function camera()
    {
        var video = document.getElementById('video');

        if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // Not adding `{ audio: true }` since we only want video now
            navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                //video.src = window.URL.createObjectURL(stream);
                video_switch = stream;
                video.srcObject = stream;
                video.play();
            });
        }
    }
    // camera();


    $('.camera').click(function(){
        
        state = $(this).attr('state');
        if (state == "off")
        {
             $(this).attr('state', "on");
             $(this)[0].innerHTML = 'Stop Video';

             $('.screenShare').attr('state', "off");
             $('.screenShare')[0].innerHTML = 'Start ScreenShare';
             if (screenShare_switch!=null)
            {
                screenShare_switch.getTracks().forEach(function(track) {
                    track.stop();
                });
            }

             camera();
        }
        else
        {
            $(this).attr('state', "off");
            $(this)[0].innerHTML = 'Start Video';

            video_switch.getTracks().forEach(function(track) {
                track.stop();
            });
            
        }

        // console.log(state);
    });

    $('.screenShare').click(function(){
        
        state = $(this).attr('state');
        if (state == "off")
        {
            $(this).attr('state', "on");
            $(this)[0].innerHTML = 'Stop ScreenShare';

            $('.camera').attr('state', "off");
            $('.camera')[0].innerHTML = 'Start Video';
            if (video_switch!=null)
            {
                video_switch.getTracks().forEach(function(track) {
                    track.stop();
                });
            }

            screenShare();
        }
        else
        {
            $(this).attr('state', "off");
            $(this)[0].innerHTML = 'Start ScreenShare';
            
            screenShare_switch.getTracks().forEach(function(track) {
                track.stop();
            });
        }

        // console.log(state);
    });
</script>